
<!doctype html>
    <html lang="en" data-bs-theme="light">
<head>
<base target="_top">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=0.8">

 <!-- css -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- bootstrap-table -->  
<link href="https://unpkg.com/bootstrap-table@1.22.4/dist/bootstrap-table.min.css" rel="stylesheet" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/extensions/group-by-v2/bootstrap-table-group-by.css" rel="stylesheet">

<!-- highlightjs -->
<link href = "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/a11y-light.min.css" rel ="stylesheet">
<link href = "https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" rel="stylesheet">
<link href = "https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" rel="stylesheet">

<link href = "sneat/assets/vendor/css/core.css" rel="stylesheet">

<style>

body {
padding: 5px;
background-color: #e0eec5;
}

</style>
</head>
  <body>

<!-- toast -->
<div class="toast" role="alert" aria-live="assertive" data-bs-delay="2000" data-bs-autohide="true" aria-live="assertive" aria-atomic="true">
  <div class="toast-header">
    <strong class="me-auto toast-title">Alert</strong>
    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
  <div class="toast-body">
    Hello, world! This is a toast message.
  </div>
</div>  
      
<!-- Modal -->
<div class="modal fade modal-borderless" id="modal" tabindex="-1" role="dialog" aria-labelledby="modal" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
<div class="modal-content">
   <div class="modal-header">
       <h5 class="modal-title"></h5>
       </div>
     <div class="modal-body">
     </div>
     </div>
  </div>
  </div>
</div>
                
          
<!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
            <div class="container-xxl flex-grow-1 align-items-center">
              <h4 class="py-3 mb-4">CSS Preview</h4>

              <!-- Card -->
                <div class="col-12 col-lg-12 mb-4">
                    <div class="card shadow h-100" id="table4-card">
                    <div class="row row-bordered g-0">                    
                      <div class="col-md-5">
                      
                    <div class="card-header p-3">
                  <div class="row justify-content-between align-items-center">
			<div class="col-auto">
				<div class="card-title">
				<span class="h4 title">HTML CSS</span>
				 <span class="text-muted fs-6 description"></span>
				</div>			 
			</div>
			<div class="col-auto">  

			</div>			
	</div>
	</div>
	
                <div class="card-body m-2">
			<!-- result -->
			<textarea class="form-control" id="result" disabled hidden></textarea>
			
			<!-- code -->
                <span class="text-muted">Result is posted under here.</span>
			<pre>
			<code class="form-control text-wrap language-json" style="height: 350px; width: 100%;">  
			</code>
			</pre>   


                    </div>
                  </div>

                <div class="col-md-7">                
                    <div class="card-body m-2">
                    
                    <!-- table -->
            <div id="toolbars" class="row justify-content-between align-items-center">
			<div class="col-auto">
			</div>			 

			<div class="col-auto">                       
			<div id="toolbar1"></div>
			</div>			
	</div>
				<div class="table">
				<table id='table1'>
				</table>
				</div>
				
                    </div>
                  </div>
                   </div>
                  </div>    
                  
                </div>
              </div>
              <!-- Content -->
  </body> 

<!--scripts-->
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/a2d5e8fc8a.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/bootstrap-table.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.4/dist/extensions/group-by-v2/bootstrap-table-group-by.min.js"></script>

<!-- highlightjs -->
    <script src = "https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
    <script src = "https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.8.0/dist/highlightjs-line-numbers.min.js"></script>

<!-- Others -->
<script src="https://cdn.jsdelivr.net/npm/underscore@1.13.6/underscore-umd-min.min.js"></script>  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mustache@4.2.0/mustache.min.js"></script>

<script>
//* FUNCS
 function testParse(str) {
try {
JSON.parse(str);
} catch (e) {
return undefined;
}
return JSON.parse(str);
}
     
// COLORS
function lightOrDark(color) {
    // Variables for red, green, blue values
    var r, g, b, hsp;
    
    // Check the format of the color, HEX or RGB?
    if (color.match(/^rgb/)) {

        // If HEX --> store the red, green, blue values in separate variables
        color = color.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/);
        
        r = color[1];
        g = color[2];
        b = color[3];
    } 
    else {
        
        // If RGB --> Convert it to HEX: http://gist.github.com/983661
        color = +("0x" + color.slice(1).replace( 
        color.length < 5 && /./g, '$&$&'));

        r = color >> 16;
        g = color >> 8 & 255;
        b = color & 255;
    }
    
    // HSP (Highly Sensitive Poo) equation from http://alienryderflex.com/hsp.html
    hsp = Math.sqrt(
    0.299 * (r * r) +
    0.587 * (g * g) +
    0.114 * (b * b)
    );

    // Using the HSP value, determine whether the color is light or dark
    if (hsp>127.5) {

        return 'light';
    } 
    else {

        return 'dark';
    }
}
    
// GetColors
function GetColors(data) {
const tgrb = ([k, v]) => { return (k.includes("rgb"))  ? `rgb(${v})` : undefined; };
let hm = /^(#([\da-f]{3}){1,2})$/i;
let grb = /^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/;

data = data.reduce((acc, ob, i) => (
k=ob.name, v=ob.value,
nv = {color: (hm.test(v) || grb.test(v)) ? v.replace(hm,"$1") ?? v.replace(grb,"$1") : tgrb([k,v]), get text() { 
return this.color !=undefined ? lightOrDark(this.color)=="dark" ? "white" : "black" : undefined; }
}, _.extend(ob, nv), acc.push(ob), acc), []);
return data;
}


//* DATA
var modal = $("#modal"); 
var table1 = $("#table1"); var toolbar1 = $("#toolbar1"); 
var toast = $(".toast");
var result = $("#result"); var code = $("code");
var data = {"temp":{"name":"<span class='text-secondary text-wrap'>{{name}}</span>","value":"{{#color}}<span class=\"badge badge-pill shadow-lg\" style=\"background-color: {{{color}}};\"><span style='color: {{{text}}};'>{{value}}</span></span>{{/color}} {{^color}}<span class='text-dark'>{{value}}</span>{{/color}}","action":"{{#action}} {{#isbutton}}<input type=\"checkbox\" class=\"btn-check\" name=\"{{name}}\" id=\"{{name}}-{{value}}\" value=\"{{{value}}}\" data-icons=\"{{icon}} {{ticon}}\" autocomplete=\"off\"{{#disabled}} disabled{{/disabled}}{{#selected}} checked{{/selected}}><label class=\"btn {{class}}\" for=\"{{name}}-{{value}}\"><i class=\"{{icon}}\"></i></label>{{/isbutton}}  {{#isgroup}} <div class=\"btn-group\" role=\"group\">   <button type=\"button\" class=\"btn {{class}} dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\"><i class=\"{{icon}}\"></i></button><div class=\"dropdown-menu p-2\" style=\"max-width: 200px;\"><p class=\"h6\">{{name}}</p> <div class=\"overflow-scroll\" style=\"max-height: 250px; \">{{#search}}<input type=\"text\" data-target=\"{{name}}\" id=\"{{name}}-search\" name=\"search\" class=\"form-control form-control-sm search p-2\" placeholder=\"Search\"> {{/search}}  {{#all}}<div class=\"form-check pt-2\">    \t<label class=\"form-check-label ms-3\" for=\"{{name}}-all\"><input name=\"all\" class=\"form-check-input\" type=\"checkbox\" data-target=\"{{name}}\" id=\"{{name}}-all\"> Toggle All</label> </div><div class=\"dropdown-divider\"></div> {{/all}} {{#values}}<div class=\"form-check\"><label class=\"form-check-label text-wrap text-break ms-2\" for=\"{{name}}-{{{value}}}\"><input class=\"form-check-input\" id=\"{{name}}-{{{value}}}\" type=\"{{#multiple}}checkbox{{/multiple}}{{^multiple}}radio{{/multiple}}\" value=\"{{{value}}}\" name=\"{{name}}\"{{#selected}} checked{{/selected}}>{{label}}</label></div>{{#text}}<div class=\"form-text text-wrap\">{{{.}}}</div>{{/text}}{{/values}} </div>{{#select}} <select class=\"form-select\" name=\"{{name}}\" data-target=\"{{name}}-select\" data-table=\"{{table}}\" id=\"{{name}}\"> <option>...</option>{{#values}} <option value=\"{{{value}}}\"{{#selected}} selected{{/selected}}{{#disabled}} disabled{{/disabled}}>{{{label}}}</option> {{/values}}</select>    {{/select}}    </div>  </div>{{/isgroup}} {{/action}}"}};

let Review = (res) => {
    code.html(_.isString(res) ? res : JSON.stringify(res, null, " "));
     hljs.highlightAll();
    // result.select(); document.execCommand('copy');
};

var allCSS = [...document.styleSheets]
  .map((styleSheet) => {
    try {
      return {title: styleSheet.title, sheet: styleSheet.href, rules: [...styleSheet.cssRules].map((rule, ri) => rule = 
   _.values(rule.style).reduce((acc, s, si) => (
   ob = {selector: rule.selectorText, s_index: ri, index: `${si}`, name: s, value: rule.style.getPropertyValue(s)}, acc.push(ob), acc), []))
 };
} catch (e) {
      console.log("denied", styleSheet.href);
    }
  });

allCSS = allCSS.filter(sh => sh!=undefined);

// TABLE
// column
// copyRows
let cops = ["name","value","css","object"];

var columns = ["action","name","value","selector"]
.map(h => h = {field: h, title: h, cellStyle: function(column) {
let field = this.field; return {classes: "text-nowrap text-break", css: {"max-width":"100px"}
}}, get visible() { return this.field!="selector"; }, 
formatter: function(v,r,i) {
var sels = $("input[name='select']")
.filter(":checked").map(function(){return +$(this).val()}).get();

const goptions = (r, i) => {
return cops.reduce((acc, n, ni) => {
let t = [0,1].includes(ni) ? "column" : n; let nv;
switch (t) {
case "column": nv = r[n]; break;
case "css": nv = `${r.name}: ${r.value};`; break;
case "object": nv = {[r.name]: r.value}; break;
} acc[n] = nv; return acc;
}, {});
}

let options = goptions(r, i); let cl = "btn-sm btn-outline-secondary";
r.action = [{name: "copy", class: cl, isgroup: true, icon: "fa-solid fa-copy", values: _.pairs(options).map(([k, v], ci) => v= {value: _.escape(_.isString(v) ? v : JSON.stringify(v)), label: k, get text() { return this.value}
})
},
{name: "select", class: cl, isbutton: true, icon: "fa-solid fa-check", mutiple: true, value: r.index, get selected() { return (sels.length>0) ? sels.includes(+r.index) : false;
}}];
var temp = data.temp; var tm = temp[this.field];
var nv = (tm!=undefined) ? Mustache.render(tm, r) : v; 
return nv;
}});

var tb1 = {sheet: 0, selectors: [], get source() {
var source = allCSS[this.sheet].rules;
var data = this.selectors.length>0 ? source.flat().filter(sc => this.selectors.includes(sc.s_index)) : source.flat();

var data = GetColors(data);
return data;
},
get data() {
return this.source;
}, table: "#table1", height: 500, columns: columns, search: true, searchable: true, 
groupBy: true, groupByField: "selector", groupByToggle: true, groupByShowToggleIcon: true, 
classes: "table table-hover"};

//* EVENTS
// row events
$(".table").on('change', ":radio, :checkbox", function() {
let el = $(this); let type = el.attr("name");
var value = el.val(); let ck = el.prop("checked");
let alert;
switch (type) {
	case "copy":
	value = _.unescape(value);
	Review(value);
	break;

	case "select":
	let sls = $("input=[name='select']:checked");
	var ip = $(".btn[name='get-selection']");
	ip.prop("disabled", sls.length == 0);
	break;
}
});

//* TOOLBAR
var tbr = {get options() {
var tcl = "text-info";
return [{name: "sheets", class: "btn-warning", icon: "fa-solid fa-check-double", isgroup: true, values: allCSS.map((sh,i) => sh = {label: sh.title ?? i, value: i, text: sh.sheet, get selected() {
var ops = table1.bootstrapTable('getOptions');
return i == +ops.sheet;}})},

{name: "selectors", class: "btn-warning", icon: "fa-solid fa-check-double", isgroup: true, multiple: true, all: true, search:true, get values() {
var ops = table1.bootstrapTable('getOptions');
var data = allCSS[+ops.sheet].rules;
var gs = _.groupBy(data.flat(), "selector");

data = _.pairs(gs).map(([sk, st], si) => st = {value: si, label: sk, get selected() { return ops.selectors.includes(st.s_index);}
});

return data;}},

{name: "expand", class: tcl, value: "expand", icon: "fa-solid fa-angles-up", ticon: "fa-solid fa-angles-down", isbutton: true}, 

{name: "all-select", class: tcl, value: "all-select", icon: "fa-solid fa-square-check", ticon: "fa-regular fa-square-minus", isbutton: true}, 

{name: "show-select", value: "show-select", class: tcl, isbutton: true, icon: "fa-solid fa-list-check", ticon: "fa-solid fa-grip-lines"},

{name: "get-selection", class: tcl, icon: "fa-solid fa-check-double", isgroup: true, get disabled() { 
var sls = $("input=[name='select']:checked");
return sls.length == 0;},
values: cops.map((k) => k = {label: k, value: k, get selected() { return this.value=="object"}}) 
}]
}, build: function() {
var tm = data.temp.action; 
var html = Mustache.render(tm, {action: tbr.options}); toolbar1.html(html);
}};


(() => {
// table: defaults
$.extend($.fn.bootstrapTable.defaults, {
icons: {"paginationSwitchDown":"fa-caret-square-down","paginationSwitchUp":"fa-caret-square-up","refresh":"fa-sync","toggleOff":"fa-toggle-off","toggleOn":"fa-toggle-on","columns":"fa-th-list","detailOpen":"fa-plus","detailClose":"fa-minus","fullscreen":"fa-arrows-alt","search":"fa-search","clearSearch":"fa-trash","collapseGroup":"fa-chevron-up","expandGroup":"fa-chevron-down"}, iconsPrefix: "fa", loadingTemplate: function() {
return `<span class=\"fs\-3 text text\-info\"><i class=\"fa-solid fa-circle-notch fa-spin fa-lg"></i> </span>`;
}
});

table1.bootstrapTable(tb1);
tbr.build();
})();

// toolbar events
toolbar1.on('change', "input", function(e, type) {
var el = $(this);
type = type ?? el.attr("name");
var value = el.val(); var ck = el.prop("checked");
var icons = el.attr("data-icons"); var ic = el.next().find("i"); 
var ops = table1.bootstrapTable('getOptions');
var data = table1.bootstrapTable('getData');
var sels = $("input[name='select']");
var svs = sels.filter(":checked").map(function(){ return +$(this).val(); }).get();

switch (type) {
	case "search":
	var tg = el.attr("data-target");
	var ips = $(`:checkbox[name='${tg}']`);
	ips.each(function() { 
	var pr = $(this).parents(".form-check");
	(value=="" || pr.text().includes(value)) ? pr.show() : pr.hide();
	});
	break;
	
       case "all":
	tg = el.attr("data-target");
	ips = $(`input[name='${tg}']`);
	ips.prop("checked", ck);

	setTimeout(() => {
	el.trigger("change", [tg]);
	}, 500);
	
	break;

    case "sheets":
    ops.sheet = +value;
    var nops = _.assign(_.create(tb1), ops);
    table1.bootstrapTable('refreshOptions', nops);
    tbr.build();
    break;

    case "selectors":
    var ls = $("input[name='selectors']");
    var sls = $("input[name='selectors']:checked")
    .map(function() { return +$(this).val(); }).get();
    var nops = _.assign(_.create(tb1), ops, {selectors: (ls.length==sls.length) ? [] : sls, groupBy: (ls.length==sls.length) ? false : ops.groupBy});
    table1.bootstrapTable('refreshOptions', nops);
    break;
     
     case "get-selection":
    var arr; var sv;
    var srs = data.filter(op => svs.includes(op.index))
    .reduce((acc, sel) => (arr = _.findWhere(sel.action, {name: "copy"}).values,
    sv = _.findWhere(arr, {label: value}).value,
    sv = _.unescape(sv), sv = (value=='object') ? JSON.parse(sv) : sv, acc.push(sv), acc) , []);    
    Review(srs);
    break;
    
    case "expand":
    ic.toggleClass(icons);
    var ck = el.prop("checked");
    var check = function(value) { return (value==true) ? "collapsed" : "expanded";};
    var rows = table1.find(`.${check(ck)}`);
    code.text(rows.length);
    rows.trigger("click");
    break;
    
    case "all-select":
    ic.toggleClass(icons);
    sels.prop("checked", ck);
    break;
    
    case "show-select":
    ic.toggleClass(icons);
    if (ck==true && svs.length != data.length) 
    table1.bootstrapTable('filterBy', { index: svs });
    
    else
    ops = _.omit(ops, "filterBy"),
    table1.bootstrapTable('refreshOptions', ops);
    break;
}
});


// action: toast
toast.on("alert", function(e, data) {
let title = $(".toast-title"); let bd = $(".toast-body");
title.text(data.title ?? title.text());
bd.text(data.msg ?? bd.text());
$(this).toast('show');
});

</script>

</body>
</html>